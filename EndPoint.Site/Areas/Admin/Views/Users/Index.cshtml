@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@using NewStore.Application.Services.Users.Queris.GetUser;
@model List<GetUserDto>;
@{
    ViewData["Title"] = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <form class="card-header">
                <fieldset class="dtr-column">
                    <button class="btn btn-primary mb-4">جست و جو</button>
                    <input class="input100 border-start-0 ms-0 form-control" name="searchKey" placeholder="نام خانوادگی" />
                </fieldset>
            </form>
            <div class="card-body">
                <a asp-area="admin" asp-action="create" id="table2-new-row-button" class="btn btn-primary mb-4"> Add New Row</a>
                <div class="table-responsive">
                    <table class="table table-bordered border text-nowrap mb-0" id="new-edit">
                        <thead>
                            <tr>
                                <th>نام</th>
                                <th>نام خانوادگی</th>
                                <th>ایمیل</th>
                                <th>سن</th>
                                <th>وضعیت</th>
                                <th name="bstable-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <th>@item.Name</th>
                                    <th>@item.Lastname</th>
                                    <th>@item.Email</th>
                                    <th>@item.Age</th>
                                    <th>@((item.IsActive) ? "فعال" : "غیرفعال")</th>
                                    <td name="bstable-actions">
                                        <div class="btn-list">
                                            <button id="@item.Id" type="button" class="btn btn-sm btn-primary">
                                                <span class="fe fe-edit"> </span>
                                            </button>
                                            <button onclick="removeUser(@item.Id)" id="@item.Id" type="button" class="btn  btn-sm btn-danger">
                                                <span class="fe fe-trash-2"> </span>
                                            </button>
                                            @if (item.IsActive)
                                            {
                                                <button onclick="ChangeUserStatus(@item.Id)" id="@item.Id" type="button" class="btn  btn-sm btn-green">
                                                    <span class="fe fe-check-circle btn-green"> </span>
                                                </button>
                                            }
                                            else
                                            {
                                                <button onclick="ChangeUserStatus(@item.Id)" id="@item.Id" type="button" class="btn  btn-sm btn-red">
                                                    <span class="fe fe-check-circle btn-red"> </span>
                                                </button>
                                            }

                                            <button onclick="ShowModal('@item.Id', '@item.Name', '@item.Lastname', '@item.Email')" type="button" class="btn  btn-sm btn-red">
                                                <span class="fe btn-red fa-edit "> </span>
                                            </button>
                                            <button id="@item.Id" type="button" class="btn  btn-sm btn-danger" style="display:none;">
                                                <span class="fe fe-x-circle"> </span>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <link href="~/Sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <script src="~/Sweetalert2/sweetalert2.min.js"></script>

    <script>
        function removeUser(id){
            var data = {
                "userId":id,
            };
            swal.fire({
                title:"هشدار",
                text:"از حذف کاربر اطمینان دارید ؟",
                icon:"warnig",
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'بله ثبت نام انجام شود',
                cancelButtonText: 'خیر'
            }).then(function()
            {
                $.ajax({
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: 'json',
                    type: "POST",
                    url: "Remove",
                    data: data,
                    success: function (data) {
                        console.log(data)
                        location.reload();
                    }
                        });

            });
        }

        function ChangeUserStatus(id){
            var data = {
                "userId":id,
            };
            swal.fire({
                title:"هشدار",
                text:"ایا از تغیر حالت کاربر اطمینان دارید ؟",
                icon:"warning",
                showCancelButton :true,
                confirmButtonText:"اره تغیر بده",
                cancelButtonText:"تغیر نده",
            }).then(function (result) {
                if(result.value){

                    $.ajax({
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: 'json',
                    type: "POST",
                    url: "ChangeUserStatus",
                    data: data,
                    success: function (data) {
                        if(data.isSuccess){
                            swal.fire({
                                title:"عملیات با موفقیت انجام شد",
                                text:data.message,
                                icon:"info",
                            }).then(function(){
                                location.reload();
                            })

                        }

                    }

                    });

                }

            });
        }

        function ShowModal(id, name, lastname, email){
            console.log("Show");
            $('#EditId').val(id);
            $('#EditName').val(name);
            $('#EditLastname').val(lastname);
            $('#EditEmail').val(email);
            $("#EditModal").modal('show');
            console.log("Show");
        }

        function EditUser(){

           var id = $('#EditId').val();

           var name =$('#EditName').val();

           var lastname= $('#EditLastname').val();

           var email=  $('#EditEmail').val();

            var data = {
                'userId':id,
                'name':name,
                'lastname':lastname,
                'email':email,
            }

            swal.fire({
                title:"هشدار",
                text:'از ویرایش کاربر مطمئن هستید ؟',
                icon:'warning',
                showCancelButton:true,
                cancelButtonText:"لغو",
            }).then(function(confirm){
               if(confirm){
                    $.ajax({
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: 'json',
                    type: "POST",
                    url: "Edit",
                    data: data,
                    success: function (dt) {
                        console.log(dt);
                        if(dt.isSuccess){
                            swal.fire({
                                title:"عملیات موفق",
                                text:"کاربر با موفقیت ویرایش شد",
                                icon:"success",
                            });
                            location.reload();
                        }
                        else{
                            swal.fire({
                                title:"عملیات شکست خورد",
                                text:dt.message,
                                icon:"error",
                            });
                        }
                    }
                        });
               }
            });
        }

        function Search(){
            var searchKey = $("#inpSearch").val();
            var data = {
                'searchKey':searchKey,
            }
            console.log(data);
             $.ajax({
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: 'json',
                    type: "POST",
                    url: "Index",
                    data: data,
                    success: function (dt) {
                        if(dt.isSuccess){
                            console.log("Success");
                            location.reload();
                        }
                    }
                        });

        }

    </script>
}


@section Modals {
    <div class="modal fade" id="EditModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">عنوان مودال</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input id="EditId" style="display:none" />
                    <label>نام</label>
                    <input class="input100 border-start-0 ms-0 form-control" id="EditName" placeholder="نام" />
                    <label>نام خانوادگی</label>
                    <input class="input100 border-start-0 ms-0 form-control" id="EditLastname" placeholder="نام خانوادگی" />
                    <label>ایمیل</label>
                    <input class="input100 border-start-0 ms-0 form-control" id="EditEmail" placeholder="ایمیل" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                    <button type="button" onclick="EditUser()" class="btn btn-primary">ذخیره</button>
                </div>
            </div>
        </div>
    </div>
}